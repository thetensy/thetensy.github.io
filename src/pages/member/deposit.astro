---
// æœƒå“¡å„²å€¼é é¢
// é¸æ“‡å„²å€¼é‡‘é¡ã€é¡¯ç¤ºå„ªæƒ ã€éŠ€è¡ŒåŒ¯æ¬¾è³‡è¨Š

import Layout from '../../layouts/Layout.astro';
import Header from '../../components/Header.astro';
---

<Layout title="æœƒå“¡å„²å€¼">
  <Header />
  
  <main class="deposit-page">
    <div class="container">
      <div class="page-header">
        <a href="/member" class="back-link">â† è¿”å›æœƒå“¡ä¸­å¿ƒ</a>
        <h1>ğŸ’³ æœƒå“¡å„²å€¼</h1>
        <p class="page-desc">å„²å€¼äº«æŠ˜æ‰£ï¼Œå¤§é¡å„²å€¼å†é€è³¼ç‰©é‡‘ï¼</p>
      </div>
      
      <div class="deposit-layout">
        <!-- å·¦å´ï¼šå„²å€¼é¸é … -->
        <div class="deposit-options">
          <!-- ç›®å‰ç‹€æ…‹ -->
          <div class="current-status card" id="currentStatus">
            <div class="status-row">
              <div class="status-item">
                <span class="status-label">ç›®å‰ç­‰ç´š</span>
                <span class="status-value tier" id="currentTier">
                  <span class="tier-icon">ğŸ‘¤</span>
                  ä¸€èˆ¬æœƒå“¡
                </span>
              </div>
              <div class="status-item">
                <span class="status-label">ç›®å‰é¤˜é¡</span>
                <span class="status-value">NT$ <span id="currentBalance">0</span></span>
              </div>
              <div class="status-item">
                <span class="status-label">ç´¯è¨ˆå„²å€¼</span>
                <span class="status-value">NT$ <span id="totalDeposit">0</span></span>
              </div>
            </div>
          </div>
          
          <!-- å„²å€¼é‡‘é¡é¸æ“‡ -->
          <div class="amount-section card">
            <h2>é¸æ“‡å„²å€¼é‡‘é¡</h2>
            
            <div class="amount-grid">
              <button class="amount-option" data-amount="1000">
                <span class="amount-value">NT$ 1,000</span>
              </button>
              <button class="amount-option" data-amount="3000">
                <span class="amount-value">NT$ 3,000</span>
              </button>
              <button class="amount-option highlight" data-amount="5000">
                <span class="amount-value">NT$ 5,000</span>
                <span class="amount-tag tier">ğŸ¥ˆ å‡ç´šéŠ€å¡</span>
              </button>
              <button class="amount-option bonus" data-amount="10000" data-bonus="500">
                <span class="amount-value">NT$ 10,000</span>
                <span class="amount-tag bonus">ğŸ é€ $500</span>
              </button>
              <button class="amount-option highlight bonus" data-amount="30000" data-bonus="2000">
                <span class="amount-value">NT$ 30,000</span>
                <span class="amount-tag tier">ğŸ¥‡ å‡ç´šé‡‘å¡</span>
                <span class="amount-tag bonus">ğŸ é€ $2,000</span>
              </button>
              <button class="amount-option bonus" data-amount="50000" data-bonus="4000">
                <span class="amount-value">NT$ 50,000</span>
                <span class="amount-tag bonus">ğŸ é€ $4,000</span>
              </button>
              <button class="amount-option highlight bonus featured" data-amount="100000" data-bonus="10000">
                <span class="amount-value">NT$ 100,000</span>
                <span class="amount-tag tier">ğŸ’ å‡ç´šç™½é‡‘</span>
                <span class="amount-tag bonus">ğŸ é€ $10,000</span>
                <span class="featured-badge">æœ€åˆ’ç®—</span>
              </button>
            </div>
            
            <!-- è‡ªè¨‚é‡‘é¡ -->
            <div class="custom-amount">
              <label class="custom-label">
                <input type="checkbox" id="customToggle">
                <span>è‡ªè¨‚é‡‘é¡</span>
              </label>
              <div class="custom-input-wrapper" id="customWrapper" style="display: none;">
                <span class="currency-prefix">NT$</span>
                <input 
                  type="number" 
                  id="customAmount" 
                  placeholder="è¼¸å…¥é‡‘é¡" 
                  min="500" 
                  step="100"
                >
                <span class="min-note">æœ€ä½ $500</span>
              </div>
            </div>
          </div>
          
          <!-- æœƒå“¡ç­‰ç´šèªªæ˜ -->
          <div class="tiers-info card">
            <h2>ğŸ’ æœƒå“¡ç­‰ç´šåˆ¶åº¦</h2>
            <div class="tiers-table">
              <div class="tier-row header">
                <span>ç­‰ç´š</span>
                <span>ç´¯è¨ˆå„²å€¼</span>
                <span>æŠ˜æ‰£</span>
                <span>ç‰¹æ¬Š</span>
              </div>
              <div class="tier-row" data-tier="basic">
                <span class="tier-name">ğŸ‘¤ ä¸€èˆ¬æœƒå“¡</span>
                <span>$0</span>
                <span>åŸåƒ¹</span>
                <span>åŸºæœ¬æœå‹™</span>
              </div>
              <div class="tier-row" data-tier="silver">
                <span class="tier-name">ğŸ¥ˆ éŠ€å¡æœƒå“¡</span>
                <span>$5,000+</span>
                <span class="discount">95 æŠ˜</span>
                <span>å„ªå…ˆè£½ä½œ</span>
              </div>
              <div class="tier-row" data-tier="gold">
                <span class="tier-name">ğŸ¥‡ é‡‘å¡æœƒå“¡</span>
                <span>$30,000+</span>
                <span class="discount">9 æŠ˜</span>
                <span>æ€¥ä»¶å…åŠ åƒ¹</span>
              </div>
              <div class="tier-row" data-tier="platinum">
                <span class="tier-name">ğŸ’ ç™½é‡‘æœƒå“¡</span>
                <span>$100,000+</span>
                <span class="discount best">85 æŠ˜</span>
                <span>å°ˆå±¬è¨­è¨ˆå¸«</span>
              </div>
            </div>
          </div>
        </div>
        
        <!-- å³å´ï¼šç¢ºèªèˆ‡ä»˜æ¬¾ -->
        <aside class="deposit-summary">
          <div class="summary-card card">
            <h3>å„²å€¼æ˜ç´°</h3>
            
            <div class="summary-content">
              <!-- å„²å€¼é‡‘é¡ -->
              <div class="summary-row main">
                <span>å„²å€¼é‡‘é¡</span>
                <span class="summary-value">NT$ <span id="summaryAmount">0</span></span>
              </div>
              
              <!-- è´ˆé€é‡‘é¡ -->
              <div class="summary-row bonus" id="bonusRow" style="display: none;">
                <span>ğŸ è´ˆé€è³¼ç‰©é‡‘</span>
                <span class="summary-value bonus-value">+NT$ <span id="summaryBonus">0</span></span>
              </div>
              
              <!-- å¯¦éš›å…¥å¸³ -->
              <div class="summary-row total">
                <span>å¯¦éš›å…¥å¸³</span>
                <span class="summary-value total-value">NT$ <span id="summaryTotal">0</span></span>
              </div>
              
              <!-- åˆ†éš”ç·š -->
              <div class="summary-divider"></div>
              
              <!-- å„²å€¼å¾Œç‹€æ…‹ -->
              <div class="after-deposit" id="afterDeposit">
                <div class="after-row">
                  <span>å„²å€¼å¾Œé¤˜é¡</span>
                  <span id="afterBalance">NT$ 0</span>
                </div>
                <div class="after-row">
                  <span>ç´¯è¨ˆå„²å€¼</span>
                  <span id="afterTotalDeposit">NT$ 0</span>
                </div>
                <div class="after-row tier-change" id="tierChange" style="display: none;">
                  <span>ğŸ‰ å‡ç´šç‚º</span>
                  <span class="new-tier" id="newTier">éŠ€å¡æœƒå“¡</span>
                </div>
              </div>
            </div>
            
            <!-- ç¢ºèªå„²å€¼æŒ‰éˆ• -->
            <button class="btn btn-primary btn-xl" id="confirmBtn" disabled>
              ç¢ºèªå„²å€¼
            </button>
            
            <p class="summary-note">
              é»æ“Šå¾Œå°‡é¡¯ç¤ºåŒ¯æ¬¾è³‡è¨Š
            </p>
          </div>
          
          <!-- æ³¨æ„äº‹é … -->
          <div class="notice-card card">
            <h4>ğŸ“Œ æ³¨æ„äº‹é …</h4>
            <ul>
              <li>å„²å€¼å¾Œé¤˜é¡æ°¸ä¹…æœ‰æ•ˆï¼Œä¸æœƒéæœŸ</li>
              <li>æœƒå“¡ç­‰ç´šä¾ã€Œç´¯è¨ˆå„²å€¼ã€è¨ˆç®—ï¼Œä¸æœƒé™ç´š</li>
              <li>è´ˆé€è³¼ç‰©é‡‘åƒ…é™ç•¶æ¬¡å„²å€¼è´ˆé€</li>
              <li>ç™¼ç¥¨å°‡æ–¼ç¢ºèªæ”¶æ¬¾å¾Œé–‹ç«‹é›»å­ç™¼ç¥¨</li>
            </ul>
          </div>
        </aside>
      </div>
    </div>
  </main>
  
  <!-- åŒ¯æ¬¾è³‡è¨Š Modal -->
  <div class="modal-overlay" id="bankModal" style="display: none;">
    <div class="modal-content">
      <button class="modal-close" id="closeModal">âœ•</button>
      <div class="modal-icon">ğŸ¦</div>
      <h3 class="modal-title">éŠ€è¡ŒåŒ¯æ¬¾è³‡è¨Š</h3>
      
      <div class="bank-info">
        <div class="bank-row">
          <span class="bank-label">éŠ€è¡Œ</span>
          <span class="bank-value">åœ‹æ³°ä¸–è¯éŠ€è¡Œ (013)</span>
        </div>
        <div class="bank-row">
          <span class="bank-label">å¸³è™Ÿ</span>
          <span class="bank-value" id="bankAccount">000-00-000000-0</span>
          <button class="copy-btn" id="copyAccount">è¤‡è£½</button>
        </div>
        <div class="bank-row">
          <span class="bank-label">æˆ¶å</span>
          <span class="bank-value">æ·»å–œè¨­è¨ˆ</span>
        </div>
        <div class="bank-row highlight">
          <span class="bank-label">åŒ¯æ¬¾é‡‘é¡</span>
          <span class="bank-value amount" id="bankAmount">NT$ 0</span>
        </div>
      </div>
      
      <div class="deposit-code">
        <p>å„²å€¼ä»£ç¢¼</p>
        <p class="code" id="depositCode">-</p>
        <p class="code-note">è«‹åœ¨åŒ¯æ¬¾å‚™è¨»å¡«å¯«æ­¤ä»£ç¢¼ï¼Œæˆ–é€é LINE å‘ŠçŸ¥</p>
      </div>
      
      <div class="bank-notice">
        <p>ğŸ“Œ åŒ¯æ¬¾å¾Œè«‹é€é LINE å‘ŠçŸ¥ï¼š</p>
        <p>1. å¸³è™Ÿæœ«äº”ç¢¼</p>
        <p>2. å„²å€¼ä»£ç¢¼</p>
        <p>ç¢ºèªæ”¶æ¬¾å¾Œï¼Œé¤˜é¡å°‡ç«‹å³å…¥å¸³ï¼</p>
      </div>
      
      <a href="https://lin.ee/JQQdhG6" target="_blank" class="btn btn-line btn-lg">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="currentColor">
          <path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.63-.63h2.386c.346 0 .627.285.627.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.193 0-.378-.104-.481-.281l-2.432-3.308v2.962c0 .349-.282.63-.63.63-.345 0-.627-.281-.627-.63V8.108c0-.27.173-.51.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.478.281l2.439 3.308V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-5.741 0c0 .349-.282.63-.631.63-.345 0-.627-.281-.627-.63V8.108c0-.345.282-.63.63-.63.346 0 .628.285.628.63v4.771zm-2.466.63H4.917c-.345 0-.63-.281-.63-.63V8.108c0-.345.285-.63.63-.63.349 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/>
        </svg>
        LINE å‘ŠçŸ¥åŒ¯æ¬¾
      </a>
      
      <button class="btn btn-ghost" id="closeModalBtn">ç¨å¾Œå†èªª</button>
    </div>
  </div>
</Layout>

<style>
  .deposit-page {
    padding-top: calc(var(--header-height) + var(--space-8) + 4px);
    padding-bottom: var(--space-16);
    min-height: 100vh;
    background: var(--cream);
  }
  
  .page-header {
    margin-bottom: var(--space-8);
  }
  
  .back-link {
    display: inline-block;
    font-size: 14px;
    color: var(--gray-500);
    margin-bottom: var(--space-2);
    transition: color 0.2s;
  }
  
  .back-link:hover {
    color: var(--primary);
  }
  
  .page-header h1 {
    font-family: var(--font-display);
    font-size: 32px;
    font-weight: 800;
    color: var(--gray-800);
    margin-bottom: var(--space-2);
  }
  
  .page-desc {
    font-size: 16px;
    color: var(--gray-500);
  }
  
  .deposit-layout {
    display: grid;
    grid-template-columns: 1fr 380px;
    gap: var(--space-8);
    align-items: start;
  }
  
  @media (max-width: 1024px) {
    .deposit-layout {
      grid-template-columns: 1fr;
    }
    
    .deposit-summary {
      position: fixed;
      bottom: 0;
      left: 0;
      right: 0;
      padding: var(--space-4);
      background: white;
      border-top: 1px solid var(--gray-200);
      box-shadow: 0 -4px 20px rgba(0,0,0,0.1);
      z-index: 100;
    }
    
    .summary-card {
      box-shadow: none !important;
      padding: 0 !important;
    }
    
    .summary-card h3,
    .summary-content,
    .summary-note,
    .notice-card {
      display: none;
    }
    
    .summary-card .btn {
      margin: 0;
    }
  }
  
  .card {
    background: white;
    border-radius: var(--radius-xl);
    padding: var(--space-6);
    box-shadow: var(--shadow);
    margin-bottom: var(--space-6);
  }
  
  .card h2 {
    font-size: 18px;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-5);
  }
  
  /* ç›®å‰ç‹€æ…‹ */
  .current-status {
    background: linear-gradient(135deg, #2E3B6B 0%, #3D4F8F 100%);
    color: white;
  }
  
  .status-row {
    display: flex;
    justify-content: space-between;
  }
  
  @media (max-width: 640px) {
    .status-row {
      flex-direction: column;
      gap: var(--space-3);
    }
  }
  
  .status-item {
    text-align: center;
  }
  
  .status-label {
    display: block;
    font-size: 12px;
    opacity: 0.7;
    margin-bottom: var(--space-1);
  }
  
  .status-value {
    display: block;
    font-size: 18px;
    font-weight: 700;
  }
  
  .status-value.tier {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
  }
  
  /* é‡‘é¡é¸æ“‡ */
  .amount-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: var(--space-3);
    margin-bottom: var(--space-5);
  }
  
  @media (max-width: 640px) {
    .amount-grid {
      grid-template-columns: 1fr;
    }
  }
  
  .amount-option {
    position: relative;
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: var(--space-2);
    padding: var(--space-5);
    background: var(--gray-50);
    border: 2px solid transparent;
    border-radius: var(--radius-lg);
    cursor: pointer;
    transition: all 0.2s;
  }
  
  .amount-option:hover {
    border-color: var(--gray-300);
    transform: translateY(-2px);
  }
  
  .amount-option.selected {
    border-color: var(--primary);
    background: rgba(46, 59, 107, 0.05);
  }
  
  .amount-option.highlight {
    background: linear-gradient(135deg, rgba(255, 205, 86, 0.1) 0%, rgba(78, 205, 196, 0.1) 100%);
  }
  
  .amount-option.highlight.selected {
    border-color: var(--teal);
  }
  
  .amount-option.featured {
    grid-column: span 2;
    background: linear-gradient(135deg, rgba(139, 92, 246, 0.1) 0%, rgba(78, 205, 196, 0.1) 100%);
  }
  
  @media (max-width: 640px) {
    .amount-option.featured {
      grid-column: span 1;
    }
  }
  
  .amount-value {
    font-size: 20px;
    font-weight: 800;
    color: var(--gray-800);
  }
  
  .amount-tag {
    font-size: 12px;
    padding: 2px 8px;
    border-radius: var(--radius-full);
  }
  
  .amount-tag.tier {
    background: var(--teal);
    color: white;
  }
  
  .amount-tag.bonus {
    background: #FEF3C7;
    color: #92400E;
  }
  
  .featured-badge {
    position: absolute;
    top: -10px;
    right: 16px;
    background: var(--accent);
    color: white;
    font-size: 11px;
    font-weight: 700;
    padding: 4px 10px;
    border-radius: var(--radius-full);
  }
  
  /* è‡ªè¨‚é‡‘é¡ */
  .custom-amount {
    padding-top: var(--space-4);
    border-top: 1px solid var(--gray-200);
  }
  
  .custom-label {
    display: flex;
    align-items: center;
    gap: var(--space-2);
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-700);
    cursor: pointer;
    margin-bottom: var(--space-3);
  }
  
  .custom-label input {
    width: 18px;
    height: 18px;
    accent-color: var(--primary);
  }
  
  .custom-input-wrapper {
    position: relative;
    display: flex;
    align-items: center;
    gap: var(--space-2);
  }
  
  .currency-prefix {
    font-size: 16px;
    font-weight: 600;
    color: var(--gray-600);
  }
  
  .custom-input-wrapper input {
    flex: 1;
    padding: var(--space-3) var(--space-4);
    border: 2px solid var(--gray-200);
    border-radius: var(--radius);
    font-size: 18px;
    font-weight: 700;
    color: var(--gray-800);
  }
  
  .custom-input-wrapper input:focus {
    outline: none;
    border-color: var(--primary);
  }
  
  .min-note {
    font-size: 12px;
    color: var(--gray-400);
  }
  
  /* ç­‰ç´šèªªæ˜ */
  .tiers-table {
    display: flex;
    flex-direction: column;
    gap: var(--space-2);
  }
  
  .tier-row {
    display: grid;
    grid-template-columns: 1.5fr 1fr 0.8fr 1.2fr;
    gap: var(--space-3);
    padding: var(--space-3);
    font-size: 13px;
    color: var(--gray-600);
    border-radius: var(--radius);
  }
  
  @media (max-width: 640px) {
    .tier-row {
      grid-template-columns: 1fr 1fr;
      gap: var(--space-2);
    }
    
    .tier-row span:nth-child(4) {
      display: none;
    }
  }
  
  .tier-row.header {
    font-weight: 600;
    color: var(--gray-500);
    background: var(--gray-50);
  }
  
  .tier-row[data-tier="silver"],
  .tier-row[data-tier="gold"],
  .tier-row[data-tier="platinum"] {
    background: var(--gray-50);
  }
  
  .tier-name {
    font-weight: 600;
    color: var(--gray-800);
  }
  
  .discount {
    font-weight: 700;
    color: var(--teal);
  }
  
  .discount.best {
    color: #8B5CF6;
  }
  
  /* å³å´æ‘˜è¦ */
  .deposit-summary {
    position: sticky;
    top: calc(var(--header-height) + var(--space-8));
  }
  
  .summary-card {
    margin-bottom: var(--space-4);
  }
  
  .summary-card h3 {
    font-size: 18px;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-5);
  }
  
  .summary-content {
    margin-bottom: var(--space-5);
  }
  
  .summary-row {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding: var(--space-2) 0;
    font-size: 14px;
    color: var(--gray-600);
  }
  
  .summary-row.main .summary-value {
    font-size: 18px;
    font-weight: 700;
    color: var(--gray-800);
  }
  
  .summary-row.bonus {
    color: #92400E;
    background: #FEF3C7;
    margin: var(--space-2) calc(var(--space-6) * -1);
    padding: var(--space-3) var(--space-6);
  }
  
  .bonus-value {
    font-weight: 700;
    color: #92400E;
  }
  
  .summary-row.total {
    font-size: 16px;
    font-weight: 700;
    color: var(--gray-800);
    padding-top: var(--space-4);
    border-top: 2px solid var(--gray-200);
  }
  
  .total-value {
    font-size: 24px;
    color: var(--primary);
  }
  
  .summary-divider {
    height: 1px;
    background: var(--gray-200);
    margin: var(--space-4) 0;
  }
  
  .after-deposit {
    background: var(--gray-50);
    border-radius: var(--radius);
    padding: var(--space-4);
  }
  
  .after-row {
    display: flex;
    justify-content: space-between;
    font-size: 13px;
    color: var(--gray-600);
    margin-bottom: var(--space-2);
  }
  
  .after-row:last-child {
    margin-bottom: 0;
  }
  
  .after-row.tier-change {
    color: var(--teal);
    font-weight: 700;
    padding-top: var(--space-2);
    border-top: 1px dashed var(--gray-300);
    margin-top: var(--space-2);
  }
  
  .new-tier {
    background: var(--teal);
    color: white;
    padding: 2px 10px;
    border-radius: var(--radius-full);
    font-size: 12px;
  }
  
  .summary-card .btn {
    width: 100%;
    margin-bottom: var(--space-3);
  }
  
  .summary-note {
    font-size: 12px;
    color: var(--gray-400);
    text-align: center;
  }
  
  /* æ³¨æ„äº‹é … */
  .notice-card {
    background: #FFFBEB;
    border: 1px solid #FDE68A;
  }
  
  .notice-card h4 {
    font-size: 14px;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-3);
  }
  
  .notice-card ul {
    list-style: none;
    padding: 0;
    margin: 0;
  }
  
  .notice-card li {
    font-size: 13px;
    color: var(--gray-600);
    padding-left: 20px;
    position: relative;
    margin-bottom: var(--space-2);
  }
  
  .notice-card li::before {
    content: 'â€¢';
    position: absolute;
    left: 6px;
    color: var(--gray-400);
  }
  
  .notice-card li:last-child {
    margin-bottom: 0;
  }
  
  /* Modal */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0, 0, 0, 0.5);
    display: flex;
    align-items: center;
    justify-content: center;
    z-index: 1000;
    padding: var(--space-4);
  }
  
  .modal-content {
    background: white;
    border-radius: var(--radius-2xl);
    padding: var(--space-8);
    max-width: 420px;
    width: 100%;
    position: relative;
    text-align: center;
  }
  
  .modal-close {
    position: absolute;
    top: var(--space-4);
    right: var(--space-4);
    background: none;
    border: none;
    font-size: 20px;
    color: var(--gray-400);
    cursor: pointer;
  }
  
  .modal-icon {
    font-size: 48px;
    margin-bottom: var(--space-4);
  }
  
  .modal-title {
    font-size: 20px;
    font-weight: 700;
    color: var(--gray-800);
    margin-bottom: var(--space-5);
  }
  
  .bank-info {
    background: var(--gray-50);
    border-radius: var(--radius);
    padding: var(--space-4);
    margin-bottom: var(--space-4);
    text-align: left;
  }
  
  .bank-row {
    display: flex;
    align-items: center;
    gap: var(--space-3);
    padding: var(--space-2) 0;
    border-bottom: 1px solid var(--gray-200);
  }
  
  .bank-row:last-child {
    border-bottom: none;
  }
  
  .bank-row.highlight {
    background: rgba(78, 205, 196, 0.1);
    margin: var(--space-2) calc(var(--space-4) * -1);
    padding: var(--space-3) var(--space-4);
    border-radius: var(--radius);
    border-bottom: none;
  }
  
  .bank-label {
    font-size: 13px;
    color: var(--gray-500);
    min-width: 70px;
  }
  
  .bank-value {
    font-size: 14px;
    font-weight: 600;
    color: var(--gray-800);
    flex: 1;
  }
  
  .bank-value.amount {
    font-size: 18px;
    color: var(--primary);
  }
  
  .copy-btn {
    font-size: 11px;
    padding: 4px 10px;
    background: var(--gray-200);
    border: none;
    border-radius: var(--radius-full);
    color: var(--gray-600);
    cursor: pointer;
  }
  
  .copy-btn:hover {
    background: var(--gray-300);
  }
  
  .deposit-code {
    background: var(--primary);
    color: white;
    padding: var(--space-4);
    border-radius: var(--radius);
    margin-bottom: var(--space-4);
  }
  
  .deposit-code p:first-child {
    font-size: 12px;
    opacity: 0.8;
    margin-bottom: var(--space-1);
  }
  
  .deposit-code .code {
    font-family: var(--font-mono);
    font-size: 24px;
    font-weight: 700;
    letter-spacing: 2px;
  }
  
  .deposit-code .code-note {
    font-size: 11px;
    opacity: 0.7;
    margin-top: var(--space-2);
  }
  
  .bank-notice {
    background: #FEF3C7;
    border-radius: var(--radius);
    padding: var(--space-4);
    margin-bottom: var(--space-5);
    text-align: left;
    font-size: 13px;
    color: var(--gray-700);
  }
  
  .bank-notice p {
    margin-bottom: var(--space-1);
  }
  
  .bank-notice p:last-child {
    margin-bottom: 0;
    margin-top: var(--space-2);
    font-weight: 600;
  }
  
  /* Buttons */
  .btn {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: var(--space-2);
    padding: var(--space-3) var(--space-6);
    border-radius: var(--radius-full);
    font-weight: 600;
    font-size: 14px;
    border: none;
    cursor: pointer;
    transition: all 0.2s ease;
  }
  
  .btn-lg {
    padding: var(--space-4) var(--space-8);
    font-size: 15px;
    width: 100%;
  }
  
  .btn-xl {
    padding: var(--space-4) var(--space-8);
    font-size: 16px;
  }
  
  .btn-primary {
    background: var(--primary);
    color: white;
  }
  
  .btn-primary:hover:not(:disabled) {
    background: var(--primary-light);
    transform: translateY(-2px);
  }
  
  .btn-primary:disabled {
    background: var(--gray-300);
    cursor: not-allowed;
  }
  
  .btn-line {
    background: var(--line-green);
    color: white;
  }
  
  .btn-line:hover {
    background: #05B04C;
  }
  
  .btn-ghost {
    background: transparent;
    color: var(--gray-500);
    margin-top: var(--space-2);
  }
  
  .btn-ghost:hover {
    color: var(--gray-700);
  }
</style>

<script>
  import { getMember, memberTiers, calculateTier, getUpgradeAmount } from '../../lib/member';
  import { formatPrice } from '../../lib/cart';
  
  // DOM å…ƒç´ 
  const currentTier = document.getElementById('currentTier');
  const currentBalance = document.getElementById('currentBalance');
  const totalDeposit = document.getElementById('totalDeposit');
  const amountOptions = document.querySelectorAll('.amount-option');
  const customToggle = document.getElementById('customToggle') as HTMLInputElement;
  const customWrapper = document.getElementById('customWrapper');
  const customAmount = document.getElementById('customAmount') as HTMLInputElement;
  const summaryAmount = document.getElementById('summaryAmount');
  const bonusRow = document.getElementById('bonusRow');
  const summaryBonus = document.getElementById('summaryBonus');
  const summaryTotal = document.getElementById('summaryTotal');
  const afterBalance = document.getElementById('afterBalance');
  const afterTotalDeposit = document.getElementById('afterTotalDeposit');
  const tierChange = document.getElementById('tierChange');
  const newTier = document.getElementById('newTier');
  const confirmBtn = document.getElementById('confirmBtn') as HTMLButtonElement;
  const bankModal = document.getElementById('bankModal');
  const closeModal = document.getElementById('closeModal');
  const closeModalBtn = document.getElementById('closeModalBtn');
  const bankAmount = document.getElementById('bankAmount');
  const depositCode = document.getElementById('depositCode');
  const copyAccount = document.getElementById('copyAccount');
  
  // ç‹€æ…‹
  let selectedAmount = 0;
  let selectedBonus = 0;
  const member = getMember();
  
  // åˆå§‹åŒ–æœƒå“¡ç‹€æ…‹
  function initMemberStatus() {
    if (member) {
      const tier = memberTiers[member.tier];
      currentTier!.innerHTML = `<span class="tier-icon">${getTierIcon(member.tier)}</span>${tier.name}`;
      currentBalance!.textContent = formatPrice(member.balance);
      totalDeposit!.textContent = formatPrice(member.totalDeposit);
    }
  }
  
  function getTierIcon(tier: string): string {
    const icons: Record<string, string> = {
      basic: 'ğŸ‘¤',
      silver: 'ğŸ¥ˆ',
      gold: 'ğŸ¥‡',
      platinum: 'ğŸ’'
    };
    return icons[tier] || 'ğŸ‘¤';
  }
  
  // é¸æ“‡é‡‘é¡
  amountOptions.forEach(option => {
    option.addEventListener('click', () => {
      // å–æ¶ˆè‡ªè¨‚é‡‘é¡
      customToggle.checked = false;
      customWrapper!.style.display = 'none';
      customAmount.value = '';
      
      // å–æ¶ˆå…¶ä»–é¸æ“‡
      amountOptions.forEach(o => o.classList.remove('selected'));
      option.classList.add('selected');
      
      // å–å¾—é‡‘é¡å’Œè´ˆé€
      selectedAmount = parseInt((option as HTMLElement).dataset.amount || '0');
      selectedBonus = parseInt((option as HTMLElement).dataset.bonus || '0');
      
      updateSummary();
    });
  });
  
  // è‡ªè¨‚é‡‘é¡
  customToggle?.addEventListener('change', () => {
    if (customToggle.checked) {
      customWrapper!.style.display = 'flex';
      amountOptions.forEach(o => o.classList.remove('selected'));
      selectedBonus = 0;
      customAmount.focus();
    } else {
      customWrapper!.style.display = 'none';
      selectedAmount = 0;
      updateSummary();
    }
  });
  
  customAmount?.addEventListener('input', () => {
    selectedAmount = parseInt(customAmount.value) || 0;
    
    // è‡ªå‹•è¨ˆç®—è´ˆé€ï¼ˆè‡ªè¨‚é‡‘é¡ä¹Ÿäº«è´ˆé€ï¼‰
    if (selectedAmount >= 100000) selectedBonus = Math.floor(selectedAmount * 0.1);
    else if (selectedAmount >= 50000) selectedBonus = Math.floor(selectedAmount * 0.08);
    else if (selectedAmount >= 30000) selectedBonus = Math.floor(selectedAmount * 0.067);
    else if (selectedAmount >= 10000) selectedBonus = Math.floor(selectedAmount * 0.05);
    else selectedBonus = 0;
    
    updateSummary();
  });
  
  // æ›´æ–°æ‘˜è¦
  function updateSummary() {
    const memberBalance = member?.balance || 0;
    const memberTotalDeposit = member?.totalDeposit || 0;
    
    summaryAmount!.textContent = formatPrice(selectedAmount);
    
    // è´ˆé€é‡‘é¡
    if (selectedBonus > 0) {
      bonusRow!.style.display = 'flex';
      summaryBonus!.textContent = formatPrice(selectedBonus);
    } else {
      bonusRow!.style.display = 'none';
    }
    
    // å¯¦éš›å…¥å¸³
    const total = selectedAmount + selectedBonus;
    summaryTotal!.textContent = formatPrice(total);
    
    // å„²å€¼å¾Œç‹€æ…‹
    afterBalance!.textContent = `NT$ ${formatPrice(memberBalance + total)}`;
    afterTotalDeposit!.textContent = `NT$ ${formatPrice(memberTotalDeposit + selectedAmount)}`;
    
    // ç­‰ç´šè®ŠåŒ–
    const currentTierLevel = member?.tier || 'basic';
    const newTierLevel = calculateTier(memberTotalDeposit + selectedAmount);
    
    if (newTierLevel !== currentTierLevel) {
      tierChange!.style.display = 'flex';
      newTier!.textContent = memberTiers[newTierLevel].name;
    } else {
      tierChange!.style.display = 'none';
    }
    
    // å•Ÿç”¨/ç¦ç”¨æŒ‰éˆ•
    confirmBtn.disabled = selectedAmount < 500;
  }
  
  // ç¢ºèªå„²å€¼
  confirmBtn?.addEventListener('click', () => {
    if (selectedAmount < 500) return;
    
    // é¡¯ç¤ºåŒ¯æ¬¾è³‡è¨Š
    bankAmount!.textContent = `NT$ ${formatPrice(selectedAmount)}`;
    depositCode!.textContent = generateDepositCode();
    bankModal!.style.display = 'flex';
  });
  
  // ç”Ÿæˆå„²å€¼ä»£ç¢¼
  function generateDepositCode(): string {
    const chars = 'ABCDEFGHJKLMNPQRSTUVWXYZ23456789';
    let code = 'D';
    for (let i = 0; i < 7; i++) {
      code += chars.charAt(Math.floor(Math.random() * chars.length));
    }
    return code;
  }
  
  // è¤‡è£½å¸³è™Ÿ
  copyAccount?.addEventListener('click', () => {
    navigator.clipboard.writeText('000-00-000000-0');
    copyAccount.textContent = 'å·²è¤‡è£½ï¼';
    setTimeout(() => {
      copyAccount.textContent = 'è¤‡è£½';
    }, 2000);
  });
  
  // é—œé–‰ Modal
  closeModal?.addEventListener('click', () => {
    bankModal!.style.display = 'none';
  });
  
  closeModalBtn?.addEventListener('click', () => {
    bankModal!.style.display = 'none';
  });
  
  bankModal?.addEventListener('click', (e) => {
    if (e.target === bankModal) {
      bankModal.style.display = 'none';
    }
  });
  
  // é«˜äº®ç•¶å‰ç­‰ç´š
  function highlightCurrentTier() {
    const currentTierLevel = member?.tier || 'basic';
    const tierRows = document.querySelectorAll('.tier-row[data-tier]');
    
    tierRows.forEach(row => {
      if ((row as HTMLElement).dataset.tier === currentTierLevel) {
        row.classList.add('current');
        (row as HTMLElement).style.background = 'rgba(78, 205, 196, 0.1)';
        (row as HTMLElement).style.border = '2px solid var(--teal)';
      }
    });
  }
  
  // åˆå§‹åŒ–
  initMemberStatus();
  highlightCurrentTier();
  updateSummary();
</script>
